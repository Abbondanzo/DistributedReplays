{% macro jsonify(list, keys) -%}
{% for item in list %}
{
    {% for key in keys %}
    {{key}}: '{{item[key]}}',
    {% endfor %}
},
{% endfor %}
{%- endmacro %}



{% macro print_list(list, key) -%}
{% for item in list %}"{{item[key]}}",{% endfor %}
{%- endmacro %}


<div style="position:relative; overflow-x: hidden; width:100%;">
    {# orange #}
    {% set team_names = ['Blue', 'Orange'] %}
    {% set team_members = ((replay.playergames|sort(attribute='is_orange', reverse=True)))|sort(attribute='score', reverse=True) %}
    {% set graphs = ["score", "goals", "assists", "saves", "shots"] %}
    {% set graph_length = graphs|length %}
    {% set json_keys = ["name", "is_orange"] + graphs %}
    <script>
        (function(host_id, action_element_id,  labels) {
            document.addEventListener("DOMContentLoaded", function () {
                const replay_data = [ {{ jsonify(team_members, json_keys) }} ];
                const player_names = [ {{ print_list(team_members, 'name')}} ];
                requirejs(['matchHistory'], function (matchHistory) {
                    matchHistory.addAction(action_element_id, host_id, labels, replay_data, player_names);
                });
            });
        })('{{ dropdown_id }}', '{{ match_id }}', {{ graphs|tojson }})
    </script>
    <div class="team blue">
        <h4>{{ team_names[0] }}</h4>
    </div>
    <div class="graph-labels-container">
        {% for player in team_members %}
        <div class="graph-label player-{{ player.name }}">
            <div class="label-color"> </div>
            {% set pid = player.player_object.platformid %}
            {% if pid|string|length == 17 %}
            <a href="{{ url_for('players.view_player', id_=pid) }}" class="name">{{ player.name }}</a>
            {% else %}
            <div class="name">{{ player.name }}</div>
            {% endif %}
            {% if player.online_id in ranks %}
            <img src="/static/img/ranks/{{ (ranks[player.online_id]['8']|sort(attribute='mode'))[-1]['tier'] }}.png"
                 height="30px"/>
            {% endif %}
            {% if player.is_bot %}
            <i class="bot">Bot</i>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <div class="graph-list-container" style="position:relative;">
        {% for graph in graphs %}
        <div style="position:relative; height={{ 90/graph_length }}%; width:100%;" class="graph-name-container">
            <div class="graph-name">{{ graph }}</div>
            <div class="graph-holder {{ graph }}"></div>
        </div>
        {% endfor %}
    </div>
    <div class="team orange">
        <h4>{{ team_names[1] }}</h4>
    </div>
</div>
