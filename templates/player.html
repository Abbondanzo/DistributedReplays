{% extends 'partials/base.html' %}

{% set player = profile['response']['players'][0] %}
{% block title %}Player Info{% endblock title %}
{% block imports %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='player.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='fixed_header.css') }}">
    {% include "partials/imports/graph.html" %}
{% endblock imports %}
{% block body %}
    <div class="sidebar">
        <div class="searchblock" style="margin-bottom: 15px;">
            <form action="{{ url_for('players.compare_player_redir', id_=id) }}" method="post">
                <i class="icono-sync"></i>
                <input type="text" name="other" placeholder="Compare to other user" class="search"/>
            </form>
        </div>
        <div class="header_holder">
            <span class="header">/ Profile Information
                {% if 'admin' in groups %}
                    <span title="Admin" style="color: red">[A]</span>
                {% endif %}
                {% if 'beta' in groups %}
                    <span title="Beta Tester <3" style="color: blue">[β]</span>
                {% endif %}
                {% if 'alpha' in groups %}
                    <span title="Alpha Tester <3" style="color: green">[α]</span>
                {% endif %}
        </div>
        <div class="playerpanel">
            {% if player %}
                {% include "partials/player/profile.html" %}
            {% endif %}
        </div>
        <div class="header_holder">
            <span class="header">/ Player Stats</span>
        </div>
        {% include "partials/player/stats.html" %}
        <div class="header_holder">
            <span class="header">/ Rank Information</span>
        </div>
        <div class="rankpanel">
            {% if rank %}
                {% include "partials/player/ranks.html" %}
            {% else %}
                <div class="errmsg">
                    unable to find rank information for this profile (does this player own rocket league?)
                </div>
            {% endif %}
        </div>
        {% if isAdmin() %}
            <div class="header_holder">
                <span class="header">/ Admin Tools</span>
            </div>
            <div class="rankpanel">
                {% set editable_groups = ['alpha', 'beta'] %}
                {% for gp in editable_groups %}
                    {% if gp in groups %}
                        <form action="{{ url_for('admin.delrole', id=id, role=gp) }}">
                            <button>Remove from {{ gp }}</button>
                        </form>
                    {% else %}
                        <form action="{{ url_for('admin.addrole', id=id, role=gp) }}">
                            <button>Add to {{ gp }}</button>
                        </form>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
    <div class="main">
        {% if False %}
            <div class="header_holder">
                <span class="header">/ Rank Information</span>
            </div>
            <div class="rankpanel">
                {% if rank %}
                    {% include "partials/player/ranks.html" %}
                {% else %}
                    <div class="errmsg">
                        unable to find rank information for this profile (does this player own rocket league?)
                    </div>
                {% endif %}
            </div>
        {% endif %}
        <div class="header_holder">
            <span class="header">/ Tendencies</span>
                <span style="font-size: 0.4em" title="Data is represented as total standard deviations from the mean">* Data is represented as total standard deviations from the mean</span>
        </div>
        <div class="chartpanel">
            {% set min_replays = 1 %}
            {% if total_games > min_replays %}
                {% include "partials/player/spider_charts.html" %}
            {% else %}
                <div class="errmsg">
                    no replays recorded for this profile (are you using the auto-uploader?)
                </div>
            {% endif %}
        </div>
        <div class="header_holder">
        <span class="header">/ Match History<span>&nbsp;&nbsp;</span>
        </span>
        </div>
        {% if total_games > game_per_page %}
            <span id="prevpage" class="pure-button button-xsmall"><i class="icono-caretLeft clickable"></i></span>
            <span id="nextpage" class="pure-button button-xsmall"><i class="icono-caretRight clickable"></i></span>
        {% endif %}
        </span>
        <div class="matchhistory">
            {% if games %}
                {% set max_pages=total_games/game_per_page %}
                {% include "partials/replay/match_history.html" %}
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        console.log('adding history loader');
                        requirejs(['match/matchHistoryLoader'], function (loader) {
                            console.log('creating history loader');
                            loader.initializeMatchHistory('{{ id }}', {{ max_pages }});
                        })
                    });
                </script>
            {% else %}
                <div class="errmsg">
                    no matches recorded for this profile (are you using the auto-uploader?)
                </div>
            {% endif %}
        </div>
    </div>
{% endblock body %}
