{% macro create_stats(charts, pie_charts, bar_charts, replay) -%}
<div class="stat-container">
    {% for c in charts %}
    {% set pgs = replay.playergames|sort(attribute='is_orange') %}
    {% set data = pgs|map(attribute=c)|list %}
    {% if c not in pie_charts and c not in bar_charts %}
    {% set type = 'radar' %}
    {% elif c in pie_charts %}
    {% set type = 'pie' %}
    {% else %}
    {% set type = 'bar' %}
    {% endif %}
    {% if data != None and data is defined and data|length > 0 %}
    {% if data[0] != None and (data|max != 0 or data|min != 0)  %}
    {% if data|max > 0 %}
    {% set start_at_zero = (data|max - data|min)/(data|max) > 0.2 %}{# we don't want uninteresting graphs #}
    {% else %}
    {% set start_at_zero = False %}
    {% endif %}
    <div class="chart-container valign-wrapper" id="{{ c }}">
        <div class="container">
        <canvas id="canvas{{ c }}"></canvas>
            <script>
                requirejs(['server', 'colors'], function (server, colors) {
                    var labels = {{ pgs|map(attribute='name')|list|tojson }};
                    var data = {
                        'labels': labels,
                        'datasets': [
                            {
                                label: 'Count',
                                data: {{ data|tojson }},
                    {% if type == 'radar' %}
                    pointBackgroundColor: [{% for x in pgs %}colors
                        .getHorizontalChartColor({{ (loop.index0 % (pgs|length / 2))|int }}, {{ x.is_orange|tojson }})
                .backgroundColor,{% endfor %}],
                    pointRadius: 5,
                        pointHitRadius: 5,
                        {#pointHoverRadius: 6,#}
                    backgroundColor: 'rgba(0, 0, 0, 0.2)',
                    {% else %}
                    backgroundColor: [{% for x in pgs %}colors
                        .getHorizontalChartColor({{ (loop.index0 % (pgs|length / 2))|int }}, {{ x.is_orange|tojson }})
                .backgroundColor,{% endfor %}],
                    {% endif %}
                }
                ]
                }

                    var ctx = document.getElementById('canvas{{ c }}').getContext('2d');
                    var myBar = new Chart(ctx, {
                        type: '{{ type }}',
                        data: data,
                        options: {

                    {#startAngle: 120,#}
                    responsive: true,
                        legend: {
                        position: 'top',

                        {% if c not in pie_charts %}display: false{% endif %}
                    },
                    title: {
                        display: true,
                            text: '{{ c|replace('_', ' ')|capitalize }}'
                    },
                    {% if False and start_at_zero and type == 'bar' %}
                    scales: {
                        yAxes:
                            [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                    },
                    {% endif %}
                    {% if type == 'radar' %}
                    scale: {
                        ticks: {
                            beginAtZero: true
                        }
                    },
                    {% endif %}

                }
                })
                });
            </script>
        </div>
    </div>
    {% endif %}
    {% endif %}
    {% endfor %}
</div>
{%- endmacro %}
